<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A simple workflow • rcontroll</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="A simple workflow">
<meta property="og:description" content="rcontroll">
<meta property="og:image" content="https://sylvainschmitt.github.io/rcontroll/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rcontroll</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/climate.html">Generate climate data</a>
    </li>
    <li>
      <a href="../articles/lidar.html">Lidar simulation using TROLL</a>
    </li>
    <li>
      <a href="../articles/troll.html">The TROLL model</a>
    </li>
    <li>
      <a href="../articles/workflow.html">A simple workflow</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sylvainschmitt/rcontroll/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>A simple workflow</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sylvainschmitt/rcontroll/blob/HEAD/vignettes/workflow.Rmd" class="external-link"><code>vignettes/workflow.Rmd</code></a></small>
      <div class="hidden name"><code>workflow.Rmd</code></div>

    </div>

    
    
<p>This vignette gives a quick example of a simple workflow to produce a
single simulation, a stack of simulations, or start from an existing
inventory or a previous simulation.</p>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>We will use <code>rcontroll</code> with packages <code>dplyr</code>
and <code>tidyr</code> for data wrangling and <code>ggplot2</code> to do
figures.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sylvainschmitt/rcontroll" class="external-link">rcontroll</a></span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>We load the species data available for French Guiana
(<code>TROLLv3_species</code>), with associated climate data
(<code>TROLLv3_climatedaytime12</code>) and day variation
(<code>TROLLv3_daytimevar</code>). We also load a previous simulation
(<code>TROLLv3_output</code>). We generate parameters using
<code>generate_parameters</code> for a simulation per month
(<code>iterperyear</code> = 12) lasting one year (<code>nbiter</code> =
12) on a 100x100 grid (<code>cols</code> = 100 and <code>rows</code> =
100). We further duplicated parameters with a simulation index using
<code>mutate</code> and <code>unnest</code> for a stack of simulations
using a <code>seedrain</code> of 5000 (default) and 500
(default/10).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"TROLLv3_species"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"TROLLv3_climatedaytime12"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"TROLLv3_daytimevar"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"TROLLv3_output"</span><span class="op">)</span></span>
<span><span class="va">stack_parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_parameters.html">generate_parameters</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="fl">100</span>, rows <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  iterperyear <span class="op">=</span> <span class="fl">12</span>, nbiter <span class="op">=</span> <span class="fl">12</span> <span class="op">*</span> <span class="fl">1</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>simulation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"seed50000"</span>, <span class="st">"seed500"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">simulation</span><span class="op">)</span></span>
<span><span class="va">stack_parameters</span><span class="op">[</span><span class="fl">62</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">500</span> <span class="co"># Cseedrain</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="generate-parameters">Generate parameters<a class="anchor" aria-label="anchor" href="#generate-parameters"></a>
</h2>
<p>We can generate parameters and view them directly as a table with a
description of its effect using <code>generate_parameters</code> and
<code>kable</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/generate_parameters.html">generate_parameters</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fl">250</span>, rows <span class="op">=</span> <span class="fl">250</span>, nbiter <span class="op">=</span> <span class="fl">12</span> <span class="op">*</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">param</th>
<th align="right">value</th>
<th align="left">description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">cols</td>
<td align="right">250</td>
<td align="left">/* nb of columns */</td>
</tr>
<tr class="even">
<td align="left">rows</td>
<td align="right">250</td>
<td align="left">/* nb of rows */</td>
</tr>
<tr class="odd">
<td align="left">HEIGHT</td>
<td align="right">70</td>
<td align="left">/* vertical extent of simulation */</td>
</tr>
<tr class="even">
<td align="left">length_dcell</td>
<td align="right">25</td>
<td align="left">/* linear size of a dcell */</td>
</tr>
<tr class="odd">
<td align="left">nbiter</td>
<td align="right">12</td>
<td align="left">/* total nb of timesteps */</td>
</tr>
<tr class="even">
<td align="left">iterperyear</td>
<td align="right">12</td>
<td align="left">/* number of iteration per year */</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="simple-simulation">Simple simulation<a class="anchor" aria-label="anchor" href="#simple-simulation"></a>
</h2>
<p>We run a simple simulation using the <code>troll</code> function with
loaded and generated data. Set <code>verbose</code> to <code>TRUE</code>
to see the TROLL log directly in the console.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/troll.html">troll</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"test"</span>,</span>
<span>  global <span class="op">=</span> <span class="fu"><a href="../reference/generate_parameters.html">generate_parameters</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fl">100</span>, rows <span class="op">=</span> <span class="fl">100</span>,</span>
<span>    iterperyear <span class="op">=</span> <span class="fl">12</span>, nbiter <span class="op">=</span> <span class="fl">12</span> <span class="op">*</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span>,</span>
<span>  species <span class="op">=</span> <span class="va">TROLLv3_species</span>,</span>
<span>  climate <span class="op">=</span> <span class="va">TROLLv3_climatedaytime12</span>,</span>
<span>  daily <span class="op">=</span> <span class="va">TROLLv3_daytimevar</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can print a simple summary of the simulation.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span></span>
<span><span class="co">#&gt; Object of class : trollsim </span></span>
<span><span class="co">#&gt; Name : test </span></span>
<span><span class="co">#&gt; Path :  </span></span>
<span><span class="co">#&gt; Extended : TRUE </span></span>
<span><span class="co">#&gt; From data : FALSE </span></span>
<span><span class="co">#&gt; Lidar simulation : FALSE </span></span>
<span><span class="co">#&gt; Random : FALSE </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 2D discrete network: horizontal step =  1 m, one tree per 1 m^2 </span></span>
<span><span class="co">#&gt; Number of sites      :  100 x 100 </span></span>
<span><span class="co">#&gt; Number of iterations :  12 </span></span>
<span><span class="co">#&gt; Duration of timestep :  30.41667 days </span></span>
<span><span class="co">#&gt; Number of Species    :  45</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plot-outputs">Plot outputs<a class="anchor" aria-label="anchor" href="#plot-outputs"></a>
</h2>
<p>We can quickly plot simulation outputs using the
<code>autoplot</code> method for three types of outputs defined with the
<code>what</code> parameter:</p>
<ul>
<li>the <code>temporal</code> trajectories of variables for the whole
ecosystem or user-defined species,</li>
<li>the <code>spatial</code> patterns of variables, including species
labels, at forest initial or final pattern,</li>
<li>the <code>distribution</code> of variables at forest initial or
final pattern for the whole ecosystem or user-defined species.</li>
</ul>
<p>For instance here we show species temporal trajectories for all
available variables using 4 species: <em>Cecropia obtusa, Dicorynia
guianensis, Eperua grandiflora,</em> and <em>Vouacapoua
americana</em>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rcontroll</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">sim</span>,</span>
<span>  what <span class="op">=</span> <span class="st">"temporal"</span>,</span>
<span>  species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Cecropia_obtusa"</span>, <span class="st">"Dicorynia_guianensis"</span>,</span>
<span>    <span class="st">"Eperua_grandiflora"</span>, <span class="st">"Vouacapoua_americana"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="workflow_files/figure-html/fullsimG1-1.png" width="768"></p>
<blockquote>
<p>Note that <code>autoplot</code> results in a <code>ggplot2</code>
object that you can modify with the <code>+</code> operator and other
<code>ggplot2</code> commands such as <code>theme</code> used here to
change the legend position.</p>
</blockquote>
<p>Similarly, we can quickly plot the forest final patterns using
<code>autoplot</code> and <code>what</code> defined on
<code>spatial</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rcontroll</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">sim</span>, what <span class="op">=</span> <span class="st">"spatial"</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we can quickly plot variables distribution at forest final
patterns using <code>autoplot</code> and <code>what</code> defined on
<code>distribution</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rcontroll</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">sim</span>, what <span class="op">=</span> <span class="st">"distribution"</span>,</span>
<span>                    variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dbh"</span>, <span class="st">"height"</span>, <span class="st">"LA"</span>, <span class="st">"LMA"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span></code></pre></div>
<p><img src="workflow_files/figure-html/fullsimG3-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="stack-of-simulations">Stack of simulations<a class="anchor" aria-label="anchor" href="#stack-of-simulations"></a>
</h2>
<p>We run a stack of simulations using the <code>stack</code> function
with loaded and generated data. We can inactivate <code>verbose</code>
to see only the loading bar. We can define the number of cores used for
parallelization. And we can define a thinning of outputs by giving the
number of iterations to be kept to reduce the output size.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>sim_stack <span class="ot">&lt;-</span> <span class="fu">stack</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">"teststack"</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">simulations =</span> <span class="fu">c</span>(<span class="st">"seed50000"</span>, <span class="st">"seed500"</span>),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">global =</span> stack_parameters,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">species =</span> TROLLv3_species,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">climate =</span> TROLLv3_climatedaytime12,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">daily =</span> TROLLv3_daytimevar,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">2</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">thin =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="er">|</span>                                                                      <span class="er">|</span>   <span class="dv">0</span>%</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="er">|======================================================================|</span> <span class="dv">100</span>%</span></code></pre></div>
<p>We can print a simple summary of the simulations.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_stack</span></span>
<span><span class="co">#&gt; Object of class : trollstack </span></span>
<span><span class="co">#&gt; Name : seed50000 </span></span>
<span><span class="co">#&gt; Path : /tmp/RtmpsxiPde/rcontroll/teststack </span></span>
<span><span class="co">#&gt; Number of simulations : 2 </span></span>
<span><span class="co">#&gt; Extended : TRUE </span></span>
<span><span class="co">#&gt; From data : FALSE </span></span>
<span><span class="co">#&gt; Lidar simulation : FALSE </span></span>
<span><span class="co">#&gt; Random : FALSE </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 2D discrete network: horizontal step =  1 m, one tree per 1 m^2 </span></span>
<span><span class="co">#&gt; Number of sites      :  100 x 100 </span></span>
<span><span class="co">#&gt; Number of iterations :  12 </span></span>
<span><span class="co">#&gt; Duration of timestep :  30.41667 days </span></span>
<span><span class="co">#&gt; Number of Species    :  45</span></span></code></pre></div>
<p>We can quickly plot temporal trajectories for all simulations using
<code>autoplot</code> and <code>what</code> defined on
<code>temporal</code>, for instance here with basal area (ba) and
aboveground biomass (agb):</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rcontroll</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">sim_stack</span>,</span>
<span>  what <span class="op">=</span> <span class="st">"temporal"</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ba"</span>, <span class="st">"agb"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="workflow_files/figure-html/fullstackG1-1.png" width="576"></p>
<p>Similarly, we can quickly plot the forest final patterns using
<code>autoplot</code> and <code>what</code> defined on
<code>spatial</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rcontroll</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">sim_stack</span>, what <span class="op">=</span> <span class="st">"spatial"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="from-a-forest">From a forest<a class="anchor" aria-label="anchor" href="#from-a-forest"></a>
</h2>
<p>We can also run a simple simulation or a stack of simulations
starting from an existing inventory or a previous simulation using the
<code>troll</code> function with the <code>forest</code> parameter.</p>
<p>We can first have a look to the ecosystem temporal trajectories of
the <code>TROLLv3_output</code> simulation:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rcontroll</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">TROLLv3_output</span>, what <span class="op">=</span> <span class="st">"temporal"</span><span class="op">)</span></span></code></pre></div>
<p><img src="workflow_files/figure-html/unnamed-chunk-5-1.png" width="576"></p>
<p>Similarly we can have a look to the the forest final pattern from
<code>TROLLv3_output</code> that we will use to initiate the next
simulation:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rcontroll</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">TROLLv3_output</span>, what <span class="op">=</span> <span class="st">"spatial"</span>, variables <span class="op">=</span> <span class="st">"age"</span><span class="op">)</span></span></code></pre></div>
<p>To run the simulation we first extracted the forest from
<code>TROLLv3_output</code>, in which we removed unused columns (not
mandatory). Then we extracted the previous simulation parameters to run
the new one in similar conditions, we only changed the time length to 12
iterations. And we finally used the same <code>troll</code> function
adding the previous forest to initiate the simulation with the
<code>forest</code> parameter. A forest inventory can also be used with
at least coordinates and DBH.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/troll.html">troll</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"test"</span>,</span>
<span>  global <span class="op">=</span> <span class="fu"><a href="../reference/update_parameters.html">update_parameters</a></span><span class="op">(</span><span class="va">TROLLv3_output</span>, nbiter <span class="op">=</span> <span class="fl">12</span> <span class="op">*</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  species <span class="op">=</span> <span class="va">TROLLv3_output</span><span class="op">@</span><span class="va">inputs</span><span class="op">$</span><span class="va">species</span>,</span>
<span>  climate <span class="op">=</span> <span class="va">TROLLv3_output</span><span class="op">@</span><span class="va">inputs</span><span class="op">$</span><span class="va">climate</span>,</span>
<span>  daily <span class="op">=</span> <span class="va">TROLLv3_output</span><span class="op">@</span><span class="va">inputs</span><span class="op">$</span><span class="va">daily</span>,</span>
<span>  forest <span class="op">=</span> <span class="fu"><a href="../reference/get_forest.html">get_forest</a></span><span class="op">(</span><span class="va">TROLLv3_output</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can quickly plot temporal trajectories of both simulations to
check that the initialization from <code>TROLLv3_output</code> worked.
For that we updated the simulation iteration index by adding the number
realised in the previous simulation. Then we simply joined ecosystem
outputs with <code>bind_rows</code> before using <code>ggplot</code> to
show aboveground biomass (agb) temporal trajectory:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span><span class="op">@</span><span class="va">ecosystem</span><span class="op">$</span><span class="va">iter</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">@</span><span class="va">ecosystem</span><span class="op">$</span><span class="va">iter</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">TROLLv3_output</span><span class="op">@</span><span class="va">ecosystem</span><span class="op">$</span><span class="va">iter</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"TROLLv3_output"</span> <span class="op">=</span> <span class="va">TROLLv3_output</span><span class="op">@</span><span class="va">ecosystem</span>,</span>
<span>  <span class="st">"sim"</span> <span class="op">=</span> <span class="va">sim</span><span class="op">@</span><span class="va">ecosystem</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">"simulation"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">iter</span> <span class="op">/</span> <span class="fl">12</span>, <span class="va">agb</span>, col <span class="op">=</span> <span class="va">simulation</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time (years)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">Abovergound</span> <span class="op">~</span> <span class="va">biomass</span> <span class="op">~</span> <span class="op">(</span><span class="va">AGB</span> <span class="op">~</span> <span class="va">Kg</span> <span class="op">~</span> <span class="va">ha</span><span class="op">^</span><span class="op">{</span></span>
<span>    <span class="op">-</span><span class="fl">1</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="workflow_files/figure-html/unnamed-chunk-8-1.png" width="576"></p>
<blockquote>
<p>Note how the simulation AGB starts at the end of
<code>TROLLv3_output</code>’s temporal trajectory.</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="dynamic-visualisation">Dynamic visualisation<a class="anchor" aria-label="anchor" href="#dynamic-visualisation"></a>
</h2>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gifs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autogif.html">autogif</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"dynamic"</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">"height_ct"</span>,</span>
<span>  global <span class="op">=</span> <span class="fu"><a href="../reference/update_parameters.html">update_parameters</a></span><span class="op">(</span><span class="va">TROLLv3_output</span>,</span>
<span>                             nbiter <span class="op">=</span> <span class="fl">12</span> <span class="op">*</span> <span class="fl">100</span>,</span>
<span>                             extent_visual <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>  species <span class="op">=</span> <span class="va">TROLLv3_output</span><span class="op">@</span><span class="va">inputs</span><span class="op">$</span><span class="va">species</span>,</span>
<span>  climate <span class="op">=</span> <span class="va">TROLLv3_output</span><span class="op">@</span><span class="va">inputs</span><span class="op">$</span><span class="va">climate</span>,</span>
<span>  daily <span class="op">=</span> <span class="va">TROLLv3_output</span><span class="op">@</span><span class="va">inputs</span><span class="op">$</span><span class="va">daily</span>,</span>
<span>  forest <span class="op">=</span> <span class="fu"><a href="../reference/get_forest.html">get_forest</a></span><span class="op">(</span><span class="va">TROLLv3_output</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">gifs</span><span class="op">$</span><span class="va">height_ct</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Sylvain Schmitt, Guillaume Salzet, Fabian Fischer, Isabelle Maréchaux, Jérôme Chave.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
